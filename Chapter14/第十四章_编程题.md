# 题目
![](第十四章_编程题_images/第十四章编程题_1_1.png)
![](第十四章_编程题_images/第十四章编程题_1_2.png)
![](第十四章_编程题_images/第十四章编程题_2-4.png)
![](第十四章_编程题_images/第十四章编程题_5_1.png)
![](第十四章_编程题_images/第十四章编程题_5_2.png)
![](第十四章_编程题_images/第十四章编程题_5_3.png)

# 1.
头文件`winec.h`
```cpp
#ifndef __WINEC_H__
#define __WINEC_H__

#include <iostream>
#include <string>
#include <valarray>

using namespace std;

template <class T1, class T2> class Pair;       // 声明一下, 为了让 typedef 能识别 Pair
typedef valarray<int> ArrInt;
typedef Pair< ArrInt, ArrInt > PairArray;

// Pair模板类
template <class T1, class T2>
class Pair
{
    private:
        T1 a;
        T2 b;
    public:
        Pair(const T1 &aval, const T2 &bval) : a(aval), b(bval){}
        T1 & first();
        T2 & second();
        T1 first() const{return a;}
        T2 second() const{return b;}
};

template <class T1, class T2>
T1 & Pair<T1, T2>::first()
{
    return a;
}

template <class T1, class T2>
T2 & Pair<T1, T2>::second()
{
    return b;
}

// 酒 类
class Wine
{
    private:
        string label;
        // Pair<valarray<int>, valarray<int> > info;   // 第一个数组存放年份, 第二个是酒的数量
        // Pair< ArrInt, ArrInt > info;      
        PairArray info;                                 // 用 typedef 简化名字
        int year;
    public:
        Wine(const char *l, int y, const int yr[], const int bot[]);
        Wine(const char *l, int y);
        void GetBottles();      // 用于录入信息
        const string & Label() const;
        int sum() const;
        void Show() const;
};

#endif //!__WINEC_H__
```

源文件`winec.cpp`
```cpp
#include "winec.h"

/*
    在成员初始化列表中, 我们使用 valarray 的构造函数来完成类型转换:
        valarray<类型> 变量名字(数组名, 数组元素个数)
        valarray<类型> 变量名字(数组元素初始化的默认值, 数组元素个数)

        在代码中, 我们使用了typdef改名, 所以下面的 ArrInt(yr, y) 就是在使用 valarray 的构造函数
*/
Wine::Wine(const char *l, int y, const int yr[], const int bot[]) : label(l), year(y), info(ArrInt(yr, y), ArrInt(bot, y))
{
}

Wine::Wine(const char *l, int y) : label(l), year(y), info(ArrInt(0, 0), ArrInt(0, 0))      // ArrInt(0, 0) 表示数组中所有元素都是初始化为0, 然后数组内部设置为没有元素
{
}

void Wine::GetBottles()
{
    cout << "Enter " << label << " data for " << year << endl;
    for (int i = 0; i < year; i++){
        cout << "Enter year: ";
        cin >> info.first()[i];
        cout << "Enter bottles for that year: ";
        cin >> info.second()[i];
    }
}

const string & Wine::Label() const
{
    return label;
}

int Wine::sum() const
{
    return info.second().sum();     // 使用 valarray<int> 类型提供的sum方法
}

void Wine::Show() const
{
    cout << "Wine: " << label << endl;
    cout << "\t\t" << "Year\t\tBottles" << endl;
    for (int i = 0; i < year; i++){
        cout << "\t\t" << info.first()[i] << "\t\t" << info.second()[i] << endl;
    }
}
```

测试文件`p1.cpp`
```cpp
#include <iostream>
#include "winec.h"

using namespace std;

int main(void)
{
	cout << "Enter name of wine: ";
	char lab[50];
	cin.getline(lab, 50);
	cout << "Enter number of years: ";
	int yrs;
	cin >> yrs;

	Wine holding(lab, yrs);
	holding.GetBottles();
	holding.Show();

	const int YRS = 3;
	int y[YRS] = {1993, 1995, 1998};
	int b[YRS] = {48, 60, 72};

	Wine more("Gushing Grape Red", YRS, y, b);
	more.Show();

	cout << "Total bottles for " << more.Label()
        << ": " << more.sum() << endl;

	cout << "Bye\n";

	return 0;
}
```

# 2.
- 头文件`winec.h`
```cpp
#ifndef __WINEC_H__
#define __WINEC_H__

#include <iostream>
#include <string>
#include <valarray>

using namespace std;

template <class T1, class T2> class Pair;       // 声明一下, 为了让 typedef 能识别 Pair
typedef valarray<int> ArrInt;
typedef Pair< ArrInt, ArrInt > PairArray;

// Pair模板类
template <class T1, class T2>
class Pair
{
    private:
        T1 a;
        T2 b;
    public:
        Pair(const T1 &aval, const T2 &bval) : a(aval), b(bval){}
        T1 & first();
        T2 & second();
        T1 first() const{return a;}
        T2 second() const{return b;}
};

template <class T1, class T2>
T1 & Pair<T1, T2>::first()
{
    return a;
}

template <class T1, class T2>
T2 & Pair<T1, T2>::second()
{
    return b;
}

// 酒 类
class Wine : private string, private PairArray
{
    private:
        // string label;            // 私有继承之后, 将自动获得一个匿名的 string 对象, 因此这里可以不写label了
        // PairArray info;          // 同理, 可以不写info了, 它是一个匿名的 PairArray 对象
        int year;
    public:
        Wine(const char *l, int y, const int yr[], const int bot[]);
        Wine(const char *l, int y);
        void GetBottles();      // 用于录入信息
        const string & Label() const;
        int sum() const;
        void Show() const;
};

#endif //!__WINEC_H__
```

- 源文件`winec.cpp`
```cpp
#include "winec.h"

/*
    在成员初始化列表中, 我们使用 valarray 的构造函数来完成类型转换:
        valarray<类型> 变量名字(数组名, 数组元素个数)
        valarray<类型> 变量名字(数组元素初始化的默认值, 数组元素个数)

        在代码中, 我们使用了私有继承, 所以这里就需要使用类名(而不是成员名)来获得基类的对象
*/
Wine::Wine(const char *l, int y, const int yr[], const int bot[]) : string(l), year(y), PairArray(ArrInt(yr, y), ArrInt(bot, y))
{
}

Wine::Wine(const char *l, int y) : string(l), year(y), PairArray(ArrInt(0, y), ArrInt(0, y))      // ArrInt(0, 0) 表示数组中所有元素都是初始化为0, 然后数组内部设置为没有元素
{
}

void Wine::GetBottles()
{
    cout << "Enter " << (const string &)*this << " data for " << year << endl;      // 用(const string &)*this 替代了 label, 通过强制类型转换可以获得基类的匿名对象
    for (int i = 0; i < year; i++){
        cout << "Enter year: ";
        cin >> PairArray::first()[i];       // 通过类名 + 作用域解析运算符 来调用基类的方法
        cout << "Enter bottles for that year: ";
        cin >> PairArray::second()[i];
    }
}

const string & Wine::Label() const
{
    return (const string &)*this;
}

int Wine::sum() const
{
    return PairArray::second().sum();     // // 通过类名 + 作用域解析运算符 来调用基类的方法, 并且使用 valarray<int> 类型提供的sum方法
}

void Wine::Show() const
{
    cout << "Wine: " << (const string &) *this << endl;         // 用(const string &)*this 替代了 label, 通过强制类型转换可以获得基类的匿名对象
    cout << "\t\t" << "Year\t\tBottles" << endl;
    for (int i = 0; i < year; i++){
        cout << "\t\t" << PairArray::first()[i] << "\t\t" << PairArray::second()[i] << endl;  // 通过类名 + 作用域解析运算符 来调用基类的方法
    }
}
```

- 测试文件`p2.cpp`
```cpp
#include <iostream>
#include "winec.h"

using namespace std;

int main(void)
{
	cout << "Enter name of wine: ";
	char lab[50];
	cin.getline(lab, 50);
	cout << "Enter number of years: ";
	int yrs;
	cin >> yrs;

	Wine holding(lab, yrs);
	holding.GetBottles();
	holding.Show();

	const int YRS = 3;
	int y[YRS] = {1993, 1995, 1998};
	int b[YRS] = {48, 60, 72};

	Wine more("Gushing Grape Red", YRS, y, b);
	more.Show();

	cout << "Total bottles for " << more.Label()
        << ": " << more.sum() << endl;

	cout << "Bye\n";

	return 0;
}
```

