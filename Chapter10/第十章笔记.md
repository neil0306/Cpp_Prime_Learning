# 对象和类
C++是面向对象(`OOP`)的语言, 它最重要特性有:
1. 抽象
2. 封装和数据隐藏
3. 多态
4. 继承
5. 代码的可重用性

## 类
类是一种`将抽象转换为用户定义类型的C++工具`, 它将`数据表示`和`操纵数据的方法`组合成一个整洁的包.

### 类的声明
1. 类的声明 (**放在头文件**): 需要包含数据成员, 成员函数(也就是`方法, method`)描述的公有接口(public interface)
2. 类方法的实现(**放在cpp文件**): 成员函数的具体实现代码.

- 对于类的名字, 有些习惯是把类名称的**首字母大写**.

类的声明例子`stock00.h`
```cpp
/*
    类的声明
*/
#ifndef __STOCH_00_H__
#define __STOCH_00_H__

#include <string>

class Stock
{
    private:  // 私有部分, 只有public里面的成员才能访问这部分内容(一般private的成员都是通过 public 间接访问的)
        std::string company;    // 公司名
        long shares;            // 股票数量
        double share_val;       // 股票单价
        double total_val;       // 股票总价值

        void setTotal(double &total_val) 
        {
            total_val = shares * share_val;
        }

    public:   // 公有部分, 任何代码都可以直接访问
        void acquire(const std::string &co, long n, double price);
        void buy(long num, double price);
        double sell(long num, double price);
        void update(double price);
        void show();


};  // 别忘记分号, 这和结构体的语法是相同的

#endif // __STOCH_00_H__
```
- private里面的setTotal函数在实例中是没办法直接访问的, 程序要在使用这个类的时候**只能直接使用public里面的部分**.
  - 要访问/改变 private 里面的成员, 只能通过 public 提供的函数接口 或者 使用`友元函数`(涉及到类的继承, 后面才讲到).
  - 一般来说, `类的数据部分通常都放在private里面`, 组成`类的接口部分一般放在public部分`.
  - 类的成员中, 如果不指明 public, 默认情况下都是`private`, 但是一般建议显示地写出来, 增加可读性.


注意:
- 在`类声明`中`定义的函数`, 会`自动转换为内联函数`! 比例上面例子中的`setTotal()`函数, 比较短, 符合内联函数的要求.
  - **只要把函数的具体定义给写到类的声明中, 这个函数就会被转换成内联函数**.
  - 如果希望"不写在类声明里的函数"也成为内联函数, 则可以通过`inline`关键字的方式将这个函数转成内联函数 (跟普通的内联函数定义方法是一样的).

### 类和结构体的异同
类其实是结构体的扩展, 他们的区别是:
- `结构体的默认访问类型是 public`, 而`类默认是 private`.
- C++中通常**使用类来实现类描述**, 而把**结构体限制为只表示存粹的数据对象**(普通老式数据, Plain Old Data, POD)
  - 简单来说就是: 只有数据 --> 用结构体; 有数据也有(方法)函数 --> 用类



### 类的成员函数实现
类的成员函数实现跟普通函数的实现对比, 主要有以下两个不同:
1. 定义成员函数时, 需要使用作用域解析运算符(`::`)来标识函数所属的类
2. 类方法`可以访问类的private组件`, 比如定义在 private 里面的变量等等.

类的成员函数实现例子`stock00.cpp`:
```cpp
/*
    类的成员函数实现
*/
#include <iostream>
#include "stock00.h"

void Stock::acquire(const std::string &co, long n, double price)
{
    company = co;       // 直接就访问到了private里的变量
    if(n < 0){
        std::cout << "Number of shares can't be negative! " << company << " shares set to be 0!" << std::endl;
        shares = 0;
    }
    else{
        shares = n;
    }

    share_val = price;
    setTotal();     // 直接调用了 private 里的函数
}

void Stock::buy(long num, double price)
{
    if(num < 0){
        std::cout << "Number of shares can't be negative! Transaction aborted!" << std::endl;
    }
    else{
        shares += num;      // 买入股票, 持有数量增加 num
        share_val = price;
        setTotal();
    }
}

void Stock::sell(long num, double price)
{
    if(num < 0){
        std::cout << "Number of shares can't be negative! Transaction aborted!" << std::endl;
    }
    else if(num > shares){
        std::cout << "You can't sell more than you have! Transaction is aborted!" << std::endl;
    }
    else{
        shares -= num;
        share_val = price;
        setTotal();
    }
}

void Stock::update(double price)
{
    share_val = price;
    setTotal();
}

void Stock::show()
{
    using namespace std;
    cout << "Company: " << company << endl;
    cout << "Shares: " << shares << endl;
    cout << "Share price" << share_val << endl;
    cout << "Total worth: " << total_val << endl;
}
```

### 类的使用
前面定义的 "Stock"类 的使用`usestock.cpp`:
```cpp
#include <iostream>
#include "stock00.h"
using namespace std;

int main(void)
{
    Stock fluffy_the_cat;  // 实例化了一个stock的对象
    fluffy_the_cat.acquire("NanoSmart", 20, 12.5);      // 买入一支股票
    fluffy_the_cat.show();                              // 显示结果

    cout << "-------" << endl;
    fluffy_the_cat.buy(15, 18.125);
    fluffy_the_cat.show();

    cout << "-------" << endl;
    fluffy_the_cat.sell(400, 20);
    fluffy_the_cat.show();

    cout << "-------" << endl;
    fluffy_the_cat.buy(300000, 40.125);
    fluffy_the_cat.show();

    cout << "-------" << endl;
    fluffy_the_cat.sell(300000, 0.125);
    fluffy_the_cat.show();

    return 0;
}
```

### 小结
1. 类的声明, 常见的情况是分为`private`和`public`两个部分(protect后面再讨论)
   - 对于`private`: 
     - 把数据放在这部分, 可以确保数据的完整性, 这个操作实现了`数据隐藏`.
     - private 里面的所有内容都可以通过`public定义的内容`**直接访问**.
   - 对于`public`:
     - 类进行实例化出一个对象后, 该对象能够直接访问的部分只有public, 如果希望这个对象能直接操作private里面的数据, 则需要使用public里面**事先定义好的函数间接地访问**.
2. 在**类的声明**里, 如果对**某个函数直接写了具体实现**, 则这个函数会被`自动转换为内联函数`
   - 如果希望**类的具体实现部**分的某个函数也成为内联函数, 则需要使用关联词`inline`.

3. 类的定义部分:
   - 函数名字的前面都需要使用作用域解析运算符(`::`)来表明这个函数属于哪个类.




